# 上传器日志标准

## 1. 概述

本文档定义了应用程序中所有上传器组件的标准化日志机制，确保日志行为的一致性，便于日志分析和问题排查。

## 2. 日志格式规范

### 2.1 日志前缀

所有上传器日志必须包含标准化前缀，格式如下：

```
[UPLOADER-{platform}] {context}: {message}
```

- `{platform}`: 平台名称（大写），如 KUAISHOU, TENCENT, XIAOHONGSHU
- `{context}`: 上传过程上下文（大写），如 GENERAL, AUTH, UPLOAD, THUMBNAIL
- `{message}`: 日志内容

### 2.2 时间戳格式

所有日志必须包含标准化时间戳，格式如下：

```
YYYY-MM-DD HH:mm:ss Z
```

- `YYYY-MM-DD`: 年月日
- `HH:mm:ss`: 时分秒
- `Z`: 时区信息

### 2.3 完整日志格式

完整的日志格式示例：

```
2026-01-18 19:39:29 +08:00 | INFO: [UPLOADER-KUAISHOU] GENERAL: [+] 自动检测到Chrome浏览器
```

## 3. 日志记录器使用

### 3.1 获取日志记录器

在上传器组件中，使用以下方式获取标准化日志记录器：

```python
from utils.uploader_log import get_uploader_logger

class KuaiShouUploader(BaseUploader):
    def __init__(self, account_file=None, headless=None):
        super().__init__(account_file, headless)
        # 自动从platform_name属性获取平台名称
        self.logger = get_uploader_logger(self.platform_name)
        
    # 或者在需要时指定上下文
    def _set_thumbnail(self, page, thumbnail_path):
        self.logger.info("正在设置视频封面...", context="THUMBNAIL")
```

### 3.2 日志级别

使用以下日志级别，保持一致的日志级别使用：

- `debug`: 调试信息，仅用于开发和调试
- `info`: 一般信息，记录正常的执行流程
- `warning`: 警告信息，记录潜在问题但不影响执行的情况
- `error`: 错误信息，记录执行失败的情况
- `exception`: 异常信息，记录异常堆栈

> **注意**：不再使用 `success` 级别，所有成功信息使用 `info` 级别

## 4. 日志位置

### 4.1 控制台输出

所有上传器日志都会输出到控制台，便于实时监控。

### 4.2 文件存储

所有上传器日志都会存储到以下文件位置：

```
logs/uploader/{platform}.log
```

- 日志文件自动按大小（10MB）轮换
- 日志文件保留10天
- 支持回溯和诊断信息

## 5. 最佳实践

### 5.1 日志内容

- 日志内容应简洁明了，提供足够的上下文信息
- 使用一致的消息格式，如 `[+]` 表示成功， `[-]` 表示进行中， `[!]` 表示错误
- 记录关键操作的开始和结束
- 记录异常和错误的详细信息

### 5.2 上下文使用

- 在日志中使用合适的上下文，便于分类和过滤
- 常见上下文示例：
  - `GENERAL`: 通用信息
  - `AUTH`: 认证相关
  - `UPLOAD`: 视频上传相关
  - `THUMBNAIL`: 封面设置相关
  - `TAGS`: 标签设置相关
  - `SCHEDULE`: 定时发布相关

### 5.3 性能考虑

- 避免在高频循环中记录大量日志
- 对于调试信息，使用 `debug` 级别
- 考虑日志对性能的影响

## 6. 示例

### 6.1 基本使用

```python
self.logger.info("正在上传视频...", context="UPLOAD")
self.logger.warning("封面文件不存在，跳过封面设置", context="THUMBNAIL")
self.logger.error("上传视频时出错: {e}".format(e=e), context="UPLOAD")
```

### 6.2 输出示例

```
2026-01-18 19:39:29 +08:00 | INFO: [UPLOADER-KUAISHOU] UPLOAD: [+] 正在上传视频: 音乐是人生的感悟。
2026-01-18 19:39:55 +08:00 | INFO: [UPLOADER-KUAISHOU] THUMBNAIL: [+] 封面图片上传成功
2026-01-18 19:40:01 +08:00 | INFO: [UPLOADER-KUAISHOU] UPLOAD: [+] 视频发布成功
```

## 7. 迁移指南

### 7.1 替换 logger.success

将所有 `logger.success` 替换为 `logger.info`：

```python
# 替换前
self.logger.success("视频发布成功")

# 替换后
self.logger.info("视频发布成功")
```

### 7.2 更新日志记录器初始化

将日志记录器初始化从 `get_logger` 替换为 `get_uploader_logger`：

```python
# 替换前
from utils.log import get_logger
self.logger = get_logger(self.platform_name)

# 替换后
from utils.uploader_log import get_uploader_logger
self.logger = get_uploader_logger(self.platform_name)
```

## 8. 验证

确保所有上传器日志符合以下标准：

- [ ] 包含标准化前缀
- [ ] 使用标准化时间戳格式
- [ ] 输出到指定位置
- [ ] 不再使用 `logger.success`
- [ ] 日志内容提供足够的上下文信息

## 9. 版本历史

- v1.0 (2026-01-18): 初始版本
